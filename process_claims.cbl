IDENTIFICATION DIVISION.
PROGRAM-ID. PROCESS-CLAIMS.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
	SELECT CLAIM-FILE ASSIGN TO "claims.csv"
		ORGANIZATION IS SEQUENTIAL.
	SELECT OUTPUT-FILE ASSIGN TO "processed_claims.txt"
		ORGANIZATION IS SEQUENTIAL.

DATA DIVISION.
FILE SECTION.

FD CLAIM-FILE.
01 CLAIM-RECORD	PIC X(200).

FD OUTPUT-FILE.
01 OUTPUT-RECORD	PIC X(200).

WORKING-STORAGE SECTION.
01 WS-REASON		PIC X(50).
01 EOF-FLAG		PIC X VALUE "N".
01 WS-CLAIM-ID		PIC X(10).
01 WS-MEMBER-ID		PIC X(5).
01 WS-CLAIM-DATE	PIC X(8).
01 WS-CLAIM-AMOUNT-TEXT	PIC X(6).
01 WS-CLAIM-AMOUNT	PIC 9(6).

PROCEDURE DIVISION.
BEGIN.
	OPEN INPUT CLAIM-FILE
	OPEN OUTPUT OUTPUT-FILE
	PERFORM UNTIL EOF-FLAG = "Y"
		READ CLAIM-FILE
			AT END
				MOVE "Y" TO EOF-FLAG
			NOT AT END
				UNSTRING CLAIM-RECORD DELIMITED BY X'09'
					INTO WS-CLAIM-ID, WS-MEMBER-ID, WS-CLAIM-DATE, WS-CLAIM-AMOUNT-TEXT
				END-UNSTRING
				COMPUTE WS-CLAIM-AMOUNT = FUNCTION NUMVAL(WS-CLAIM-AMOUNT-TEXT)
				PERFORM PROCESS-RECORD
		END-READ
	END-PERFORM
	CLOSE CLAIM-FILE
	CLOSE OUTPUT-FILE
	STOP RUN.

PROCESS-RECORD.
	IF WS-CLAIM-AMOUNT > 1000
		MOVE "REJECTED: Amount exceeds limit" TO WS-REASON
	ELSE
		MOVE "APPROVED" TO WS-REASON
	END-IF

	STRING WS-CLAIM-ID DELIMITED BY SPACE
		X'09'
		WS-REASON DELIMITED BY SPACE
		X'0A'
		INTO OUTPUT-RECORD
	END-STRING

	WRITE OUTPUT-RECORD FROM CLAIM-RECORD AFTER ADVANCING 1 LINE
	.

END PROGRAM PROCESS-CLAIMS.
